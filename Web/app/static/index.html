<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gráficos em Tempo Real</title>
    <script src="https://cdn.jsdelivr.net/npm/plotly.js-dist@2.16.1/plotly.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/socket.io-client@4.4.1/dist/socket.io.min.js"></script>
</head>
<body>
    <h1>Gráficos de Temperatura e Umidade em Tempo Real</h1>

    <div id="temperature-graph" style="width: 100%; height: 400px;"></div>
    <div id="humidity-graph" style="width: 100%; height: 400px;"></div>

    <script>
        // Conexão WebSocket com o servidor
        const socket = io("ws://localhost:8000/ws");

        // Dados iniciais para os gráficos
        let temperatureData = {x: [], y: [], type: 'scatter', mode: 'lines+markers', name: 'Temperatura'};
        let humidityData = {x: [], y: [], type: 'scatter', mode: 'lines+markers', name: 'Umidade'};

        // Cria os gráficos iniciais
        Plotly.newPlot('temperature-graph', [temperatureData], {title: 'Média de Temperatura'});
        Plotly.newPlot('humidity-graph', [humidityData], {title: 'Média de Umidade'});

        // Função para atualizar os gráficos
        function updateGraph(data) {
            let timestamp = new Date().toLocaleTimeString();

            // Atualiza o gráfico de temperatura
            temperatureData.x.push(timestamp);
            temperatureData.y.push(data.temperature_mean);
            Plotly.update('temperature-graph', {x: [temperatureData.x], y: [temperatureData.y]});

            // Atualiza o gráfico de umidade
            humidityData.x.push(timestamp);
            humidityData.y.push(data.humidity_mean);
            Plotly.update('humidity-graph', {x: [humidityData.x], y: [humidityData.y]});
        }

        // Recebe os dados do servidor via WebSocket
        socket.on("message", function(data) {
            const parsedData = JSON.parse(data);
            updateGraph(parsedData);
        });
    </script>
</body>
</html>